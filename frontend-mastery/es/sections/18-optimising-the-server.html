<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.3.2 Optimising The Server - Frontend Mastery</title>
    <link rel="stylesheet" href="../../../assets/css/styles.css">
</head>
<body>
    <div class="container">
        <aside id="sidebar" class="sidebar"></aside>
        <main class="main-content">
            <section id="section-optimising-the-server">
                <h1>‚ö° Optimizaci√≥n del Servidor: El Segundo Paso</h1>
                <p><strong>HTTP Caching, Compression, CDN y DNS Preconnect ‚Äî C√≥mo Reducir Latencia y Bytes</strong></p>

                <div class="warning-block" data-title="‚ö†Ô∏è La Verdad">
                    <p>Si el servidor tarda 2 segundos, nada m√°s importa.</p>
                    <p>El TTFB (Time to First Byte) es el cuello de botella #1 en la mayor√≠a de apps.</p>
                    <p><strong>Este paso suele dar mejoras de 30-50% en LCP.</strong></p>
                </div>

                <h2>1Ô∏è‚É£ Mental Model: ¬øQu√© Pasa Cuando Entra un Usuario?</h2>

                <div class="analogy-block" data-title="üß† La Cadena Completa">
                    <ol>
                        <li><strong>DNS lookup</strong> ‚Äî ¬øCu√°l es la IP del servidor?</li>
                        <li><strong>TCP + TLS handshake</strong> ‚Äî Establecer conexi√≥n segura (si HTTPS)</li>
                        <li><strong>Request enviado</strong> ‚Äî El navegador pide el HTML</li>
                        <li><strong>Servidor genera respuesta</strong> ‚Äî Backend procesa</li>
                        <li><strong>Download de bytes</strong> ‚Äî Transferencia de red</li>
                        <li><strong>Browser parsea y ejecuta</strong> ‚Äî Finalmente se ve algo</li>
                    </ol>
                </div>

                <h3>¬øD√≥nde Optimizamos?</h3>

                <div class="concept-block">
                    <ul>
                        <li>‚ùå Eliminar requests innecesarias ‚Üí <strong>Caching</strong></li>
                        <li>üìâ Reducir bytes transferidos ‚Üí <strong>Compression</strong></li>
                        <li>üåç Acercar contenido al usuario ‚Üí <strong>CDN</strong></li>
                        <li>‚ö° Adelantar conexiones ‚Üí <strong>DNS Preconnect</strong></li>
                    </ul>
                </div>

                <h2>2Ô∏è‚É£ HTTP Compression: Reducir Tama√±o</h2>

                <div class="concept-block">
                    <p><strong>¬øQu√© es?</strong></p>
                    <p>Comprimir archivos (JS, CSS, HTML) antes de enviarlos al navegador.</p>
                    <p>El navegador los descomprime autom√°ticamente.</p>
                </div>

                <h3>¬øCu√°ntos Bytes Ahorras?</h3>

                <div class="analogy-block" data-title="Ejemplo Real">
                    <ul>
                        <li>Bundle JS: 3MB sin compresi√≥n</li>
                        <li>Bundle JS: 1MB comprimido</li>
                        <li><strong>Resultado: 3x m√°s r√°pido de descargar</strong></li>
                    </ul>
                </div>

                <h3>Tipos de Compresi√≥n</h3>

                <div class="solution-block" data-title="üß© Gzip vs Brotli">
                    <ul>
                        <li><strong>Gzip:</strong> Est√°ndar, m√°s compatible, m√°s r√°pido</li>
                        <li><strong>Brotli (br):</strong> M√°s moderno, comprime mejor, m√°s lento (pero en servidor)</li>
                    </ul>
                </div>

                <h3>C√≥mo Verificar en DevTools</h3>

                <div class="solution-block" data-title="üíª Pasos">
                    <ol>
                        <li>Abre DevTools ‚Üí Network tab</li>
                        <li>Click en un archivo .js</li>
                        <li>Ve a Headers</li>
                        <li>Busca <strong>content-encoding</strong></li>
                    </ol>
                </div>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üîç Qu√© Deber√≠as Ver</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <h4>‚úÖ Correcto</h4>
                        <pre><code>content-encoding: gzip
content-encoding: br
vary: Accept-Encoding</code></pre>

                        <h4>‚ùå Incorrecto</h4>
                        <pre><code>(no existe content-encoding)</code></pre>

                        <p><strong>Detalle Senior:</strong> Debe existir tambi√©n <code>Vary: Accept-Encoding</code> para que proxies y CDNs no mezclen versiones.</p>
                    </div>
                </div>

                <h3>Qu√© Comprimir y Qu√© No</h3>

                <div class="concept-block">
                    <h4>‚úÖ Siempre Comprime</h4>
                    <ul>
                        <li>JavaScript</li>
                        <li>CSS</li>
                        <li>HTML</li>
                        <li>JSON</li>
                        <li>SVG</li>
                    </ul>
                </div>

                <div class="problem-block" data-title="‚ùå No Comprimas">
                    <ul>
                        <li>JPEG/PNG (ya est√°n comprimidos)</li>
                        <li>WebP/AVIF (ya est√°n comprimidos)</li>
                        <li>Videos (ya est√°n comprimidos)</li>
                    </ul>
                </div>

                <h2>3Ô∏è‚É£ HTTP Caching: Eliminar Requests</h2>

                <div class="warning-block" data-title="‚ö†Ô∏è La Mejor Optimizaci√≥n">
                    <p>No descargar es m√°s r√°pido que descargar comprimido.</p>
                    <p>El cach√© es donde realmente ganas.</p>
                </div>

                <h3>Tipo A: Strong Cache (Cach√© de Larga Duraci√≥n)</h3>

                <div class="solution-block" data-title="üíª Header">
                    <pre><code>Cache-Control: public, max-age=31536000, immutable</code></pre>
                </div>

                <div class="concept-block">
                    <h4>¬øQu√© significa?</h4>
                    <ul>
                        <li><strong>public:</strong> P√∫blico, puede cachear en proxy/CDN</li>
                        <li><strong>max-age=31536000:</strong> Guardar 1 a√±o</li>
                        <li><strong>immutable:</strong> Nunca cambiar√°, no validar</li>
                    </ul>
                </div>

                <div class="warning-block" data-title="‚ö†Ô∏è Pero Espera">
                    <p>¬øQu√© pasa si subo c√≥digo nuevo?</p>
                    <p>El navegador sigue usando el archivo viejo 1 a√±o.</p>
                    <p><strong>Soluci√≥n: Fingerprinting (hash en el nombre)</strong></p>
                </div>

                <h3>Fingerprinting: El Patr√≥n Correcto</h3>

                <div class="solution-block" data-title="‚úÖ Ejemplo Correcto">
                    <pre><code>app.a34f9c.js      // Hash del contenido
app.b95d2e.js      // C√≥digo cambi√≥ ‚Üí hash nuevo</code></pre>
                </div>

                <div class="analogy-block" data-title="üß† C√≥mo Funciona">
                    <ol>
                        <li>Archivo original: app.js</li>
                        <li>Build genera: app.a34f9c.js (hash)</li>
                        <li>HTML apunta a: app.a34f9c.js</li>
                        <li>Usuario cachea: app.a34f9c.js durante 1 a√±o</li>
                        <li>C√≥digo cambia ‚Üí nuevo build</li>
                        <li>Build genera: app.b95d2e.js (hash diferente)</li>
                        <li>HTML apunta a: app.b95d2e.js</li>
                        <li>Usuario descarga: app.b95d2e.js (nuevo)</li>
                        <li>Usuario sigue cacheando: app.a34f9c.js (viejo, pero no se usa)</li>
                    </ol>
                </div>

                <h3>Tipo B: Revalidation Cache</h3>

                <div class="solution-block" data-title="üíª Header para HTML">
                    <pre><code>Cache-Control: no-cache
ETag: "abc123"</code></pre>
                </div>

                <div class="concept-block">
                    <h4>C√≥mo Funciona</h4>
                    <ol>
                        <li>Navegador carga: index.html</li>
                        <li>Servidor env√≠a: ETag: "abc123"</li>
                        <li>Navegador guarda el archivo</li>
                        <li>Pr√≥xima carga, navegador pregunta: ¬øETag sigue siendo "abc123"?</li>
                        <li>Si s√≠ ‚Üí Servidor responde: 304 Not Modified (sin descargar)</li>
                        <li>Si no ‚Üí Servidor env√≠a: 200 OK (descarga nueva versi√≥n)</li>
                    </ol>
                </div>

                <h3>Estrategia Senior Real (En Producci√≥n)</h3>

                <div class="solution-block" data-title="üéØ El Patr√≥n Ganador">
                    <pre><code>// HTML (index.html)
Cache-Control: no-cache
ETag: "xyz789"

// JS/CSS con hash
Cache-Control: public, max-age=31536000, immutable

// Im√°genes
Cache-Control: public, max-age=31536000

// API responses
Cache-Control: public, max-age=3600 (1 hora)</code></pre>
                </div>

                <h3>Verificar en DevTools</h3>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üîç Qu√© Ver en Network</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <h4>Primera Carga</h4>
                        <pre><code>Status: 200 OK
Size: 45 KB</code></pre>

                        <h4>Segunda Carga (Mismo navegador)</h4>
                        <pre><code>Status: 304 Not Modified
Size: 0 B

O ver√°s: (memory cache) o (disk cache)</code></pre>

                        <h4>Tercera Carga (Diferentes m√°quinas sin cach√©)</h4>
                        <pre><code>Status: 200 OK
Size: 45 KB

(Sin cach√© local)</code></pre>
                    </div>
                </div>

                <h2>4Ô∏è‚É£ CDN: Reducir Latencia F√≠sica</h2>

                <div class="problem-block" data-title="‚ùå El Problema">
                    <p>Tu servidor est√° en Alemania.</p>
                    <p>El usuario est√° en Los √Ångeles.</p>
                    <p>La distancia afecta. La velocidad m√°xima es la velocidad de la luz.</p>
                    <p><strong>Ejemplo:</strong> 200ms extra solo por latencia.</p>
                </div>

                <h3>¬øQu√© es un CDN?</h3>

                <div class="concept-block">
                    <p>Un CDN (Content Delivery Network) replica tus assets en m√∫ltiples servidores globales:</p>
                    <ul>
                        <li>üá™üá∏ Europa</li>
                        <li>üá∫üá∏ EEUU</li>
                        <li>üá¶üá∫ Asia</li>
                        <li>etc</li>
                    </ul>
                </div>

                <h3>CDNs Populares</h3>

                <div class="solution-block" data-title="üåç Opciones Reales">
                    <ul>
                        <li><strong>Cloudflare:</strong> Gratis plan b√°sico, muy popular</li>
                        <li><strong>AWS CloudFront:</strong> Enterprise, caro pero poderoso</li>
                        <li><strong>Netlify:</strong> Autom√°tico si hosteas ah√≠</li>
                        <li><strong>Vercel:</strong> Autom√°tico para Next.js</li>
                    </ul>
                </div>

                <h3>C√≥mo Detectar si Usas CDN</h3>

                <div class="solution-block" data-title="üíª Headers en DevTools">
                    <h4>Cloudflare</h4>
                    <pre><code>cf-cache-status: HIT
server: cloudflare</code></pre>

                    <h4>AWS CloudFront</h4>
                    <pre><code>x-cache: Hit from cloudfront
x-amz-cf-pop: LAX50-C1</code></pre>
                </div>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üéØ Beneficio Senior</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <p>Los CDNs normalmente:</p>
                        <ul>
                            <li>‚úÖ Aplican compresi√≥n autom√°ticamente</li>
                            <li>‚úÖ Cachean autom√°ticamente</li>
                            <li>‚úÖ Sirven desde la ubicaci√≥n m√°s cercana al usuario</li>
                            <li>‚úÖ Pueden minificar autom√°ticamente</li>
                            <li>‚úÖ Pueden optimizar im√°genes</li>
                        </ul>
                    </div>
                </div>

                <h2>5Ô∏è‚É£ DNS Preconnect: Adelantar Conexiones</h2>

                <div class="concept-block">
                    <p><strong>Problema:</strong> Cuando necesitas un recurso externo (fonts, APIs, analytics), primero hace:</p>
                    <ul>
                        <li>1Ô∏è‚É£ DNS lookup</li>
                        <li>2Ô∏è‚É£ TCP handshake</li>
                        <li>3Ô∏è‚É£ TLS negotiation</li>
                        <li>4Ô∏è‚É£ Request</li>
                    </ul>
                    <p>Cada paso tarda 50-100ms.</p>
                </div>

                <h3>Soluci√≥n: Preconnect</h3>

                <div class="solution-block" data-title="üíª En el Head">
                    <pre><code>&lt;head&gt;
  &lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;
  &lt;link rel="preconnect" href="https://api.example.com"&gt;
  &lt;link rel="preconnect" href="https://cdn.analytics.com"&gt;
&lt;/head&gt;</code></pre>
                </div>

                <div class="analogy-block" data-title="üß† Qu√© Pasa">
                    <p><strong>Sin preconnect:</strong> DNS ‚Üí TCP ‚Üí TLS ‚Üí Request ‚Üí Response</p>
                    <p><strong>Con preconnect:</strong> DNS + TCP + TLS (en paralelo) ‚Üí Request (cuando se necesita)</p>
                </div>

                <h3>‚ö†Ô∏è Importante</h3>

                <div class="warning-block" data-title="No abuses de Preconnect">
                    <p><strong>Usa para:</strong> M√°ximo 3-4 dominios cr√≠ticos</p>
                    <p><strong>NO uses para:</strong> Todos los CDNs, analytics, ads</p>
                    <p>Preconnect consume recursos.</p>
                </div>

                <h2>6Ô∏è‚É£ C√≥mo Auditar tu App (Paso a Paso)</h2>

                <div class="solution-block" data-title="üîç Auditor√≠a Real en DevTools">
                    <ol>
                        <li><strong>Abre DevTools ‚Üí Network</strong></li>
                        <li><strong>Enable "Preserve log"</strong> (checkbox)</li>
                        <li><strong>Hard reload:</strong> Right click ‚Üí Empty cache and hard reload</li>
                        <li><strong>Inspecciona el JS m√°s grande</strong>
                            <ul>
                                <li>¬øTiene content-encoding?</li>
                                <li>¬øTiene cache-control?</li>
                                <li>¬øTiene hash en el nombre?</li>
                                <li>¬øQu√© tama√±o tiene?</li>
                            </ul>
                        </li>
                        <li><strong>Recarga normal (Ctrl+R)</strong>
                            <ul>
                                <li>¬øAparece 304?</li>
                                <li>¬øAparece (memory cache)?</li>
                                <li>¬øCu√°nto tiempo tard√≥?</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <h2>7Ô∏è‚É£ Checklist: Qu√© Deber√≠a Tener tu App</h2>

                <div class="concept-block">
                    <table class="cheat-sheet-table">
                        <thead>
                            <tr>
                                <th>Recurso</th>
                                <th>Compresi√≥n</th>
                                <th>Cach√©</th>
                                <th>CDN</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>HTML</td>
                                <td>‚úÖ gzip/br</td>
                                <td>no-cache + ETag</td>
                                <td>‚úÖ S√≠</td>
                            </tr>
                            <tr>
                                <td>JS (con hash)</td>
                                <td>‚úÖ gzip/br</td>
                                <td>max-age: 1 a√±o</td>
                                <td>‚úÖ S√≠</td>
                            </tr>
                            <tr>
                                <td>CSS (con hash)</td>
                                <td>‚úÖ gzip/br</td>
                                <td>max-age: 1 a√±o</td>
                                <td>‚úÖ S√≠</td>
                            </tr>
                            <tr>
                                <td>Im√°genes</td>
                                <td>Nativa</td>
                                <td>max-age: 30 d√≠as</td>
                                <td>‚úÖ S√≠</td>
                            </tr>
                            <tr>
                                <td>API Responses</td>
                                <td>‚úÖ gzip/br</td>
                                <td>max-age: 1 hora</td>
                                <td>‚ùå No</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h2>8Ô∏è‚É£ Errores Comunes (Debes Evitar)</h2>

                <div class="problem-block" data-title="‚ùå Error #1: Cachear fuerte el HTML">
                    <p>Si cacheas index.html 1 a√±o, los usuarios quedan atrapados en versi√≥n vieja.</p>
                    <p><strong>Soluci√≥n:</strong> Usar no-cache + ETag.</p>
                </div>

                <div class="problem-block" data-title="‚ùå Error #2: No usar fingerprint en archivos">
                    <p>Si cambias el c√≥digo pero el nombre no cambia, usuarios siguen con versi√≥n vieja.</p>
                    <p><strong>Soluci√≥n:</strong> Hash en el nombre (app.a34f9c.js).</p>
                </div>

                <div class="problem-block" data-title="‚ùå Error #3: No revisar headers reales">
                    <p>Crees que todo est√° comprimido pero DevTools muestra lo contrario.</p>
                    <p><strong>Soluci√≥n:</strong> Auditar en DevTools o ejecutar curl.</p>
                </div>

                <div class="problem-block" data-title="‚ùå Error #4: Preconnect a todo">
                    <p>Preconnecta a 20 dominios y ralentiza la p√°gina.</p>
                    <p><strong>Soluci√≥n:</strong> Solo 3-4 dominios cr√≠ticos.</p>
                </div>

                <h2>9Ô∏è‚É£ Respuesta Senior en Entrevista</h2>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üé§ "¬øC√≥mo optimizar√≠as el servidor?"</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <p><strong>Respuesta Senior:</strong></p>
                        <blockquote>
                            <p>"Primero aplicar√≠a compresi√≥n (Brotli o gzip) verificando que los headers tengan content-encoding y vary: accept-encoding.</p>
                            <p>Implementar√≠a caching fuerte para assets con hash usando Cache-Control: public, max-age=31536000, immutable para JS/CSS.</p>
                            <p>Para HTML usar√≠a no-cache con ETag para revalidaci√≥n, evitando que usuarios queden atrapados en versiones viejas.</p>
                            <p>Usar√≠a un CDN para reducir la latencia geogr√°fica.</p>
                            <p>Para recursos externos cr√≠ticos, a√±adir√≠a preconnect limitado a 3-4 dominios.</p>
                            <p>Auditar√≠a todo en DevTools Network tab verificando headers reales.</p>
                            <p>El objetivo es reducir TTFB y asegurar que cambios en deploy invaliden cach√© autom√°ticamente."</p>
                        </blockquote>
                    </div>
                </div>

                <h2>üîü Conexi√≥n con Core Web Vitals</h2>

                <div class="solution-block" data-title="üìä Impacto Real">
                    <ul>
                        <li><strong>Caching:</strong> Mejora TTFB, FCP, LCP (50% en caso ideal)</li>
                        <li><strong>Compression:</strong> Mejora LCP (30-40%)</li>
                        <li><strong>CDN:</strong> Mejora TTFB (20-30%)</li>
                        <li><strong>Preconnect:</strong> Mejora LCP para recursos cr√≠ticos (10-15%)</li>
                    </ul>
                </div>

                <h2>1Ô∏è‚É£1Ô∏è‚É£ Checklist Accionable Ahora</h2>

                <div class="solution-block" data-title="‚úÖ Haz Esto Hoy">
                    <ol>
                        <li>Abre tu app en Chrome</li>
                        <li>DevTools ‚Üí Network ‚Üí Hard reload</li>
                        <li>Click en un .js grande</li>
                        <li>Mira Headers ‚Üí ¬øTiene content-encoding?</li>
                        <li>Mira Headers ‚Üí ¬øTiene cache-control?</li>
                        <li>Si no tiene compresi√≥n, activar en servidor</li>
                        <li>Si no cachea bien, ajustar headers</li>
                        <li>Si est√°s en EEUU pero servidor en Alemania, urgente CDN</li>
                        <li>Recarga normal y mira si aparece 304</li>
                    </ol>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='17-diagnosis.html'">‚Üê Volver a Diagnosis</button>
                    <button class="btn btn-primary" onclick="window.location.href='../../../index.html'">Volver al Inicio ‚Üí</button>
                </div>
            </section>
        </main>
    </div>

    <script src="../../../assets/js/app.js"></script>
</body>
</html>
