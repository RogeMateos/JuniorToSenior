<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.2 The Critical Rendering Path - Frontend Mastery</title>
    <link rel="stylesheet" href="../../../assets/css/styles.css">
</head>
<body>
    <div class="container">
        <main class="main-content">
            <section id="section-critical-rendering-path">
                <h1>üéØ The Critical Rendering Path</h1>
                <p><strong>C√≥mo el Navegador Pinta tu Web (Y Por Qu√© Importa para Performance)</strong></p>

                <div class="warning-block" data-title="‚ö†Ô∏è Por Qu√© Importa">
                    <p>Entender el Critical Rendering Path es lo que separa juniors de seniors. Si entiendes CRP, sabes exactamente d√≥nde "tocar" para mejorar FCP.</p>
                </div>

                <h2>1Ô∏è‚É£ El Modelo Mental Correcto (Y Por Qu√© Importa)</h2>

                <div class="concept-block">
                    <p>El CRP es literalmente la cadena de pasos que el navegador necesita completar antes de poder "pintar algo" (First Contentful Paint).</p>
                </div>

                <div class="analogy-block" data-title="üß† Pi√©nsalo Como una Carrera de Relevos">
                    <ol>
                        <li><strong>HTML llega primero</strong> (abre la carrera)</li>
                        <li><strong>CSS define "c√≥mo se ve"</strong> (sin eso el navegador no quiere mostrar cosas que luego cambien)</li>
                        <li><strong>JS puede cambiar DOM y CSSOM</strong> (y a veces bloquea)</li>
                        <li><strong>Luego el navegador construye</strong> lo necesario para renderizar y finalmente pinta</li>
                    </ol>
                </div>

                <h2>2Ô∏è‚É£ Critical Rendering Path: Desglose Paso a Paso</h2>

                <h3>Paso 1 ‚Äî Request del HTML (Red)</h3>

                <div class="concept-block">
                    <p>El navegador pide el HTML: DNS ‚Üí Conexi√≥n ‚Üí (TLS/SSL) ‚Üí Respuesta ‚Üí Descarga</p>
                </div>

                <div class="solution-block" data-title="üéØ Qu√© Optimizas Aqu√≠">
                    <ul>
                        <li>‚úÖ Reducir latencia / round-trips</li>
                        <li>‚úÖ Entrega r√°pida del HTML (TTFB bajo)</li>
                        <li>‚úÖ Cache / CDN / compresi√≥n</li>
                    </ul>
                </div>

                <h3>Paso 2 ‚Äî Parse HTML ‚Üí Construir DOM</h3>

                <div class="concept-block">
                    <p>El navegador parsea el HTML y construye el DOM (estructura) de forma incremental.</p>
                </div>

                <div class="problem-block" data-title="‚ö†Ô∏è Detalle Importante">
                    <p>El parseo de HTML es incremental pero se puede pausar si encuentra cosas bloqueantes (CSS render-blocking, scripts s√≠ncronos).</p>
                </div>

                <h3>Paso 3 ‚Äî CSS: Fetch + Parse ‚Üí CSSOM</h3>

                <div class="concept-block">
                    <p><code>&lt;link rel="stylesheet"&gt;</code> en el <code>&lt;head&gt;</code> dispara descargas y construcci√≥n del CSSOM.</p>
                </div>

                <div class="warning-block" data-title="‚ö†Ô∏è Por Qu√© CSS Bloquea el Render">
                    <p>Sin CSS, el navegador podr√≠a mostrar contenido sin estilo y luego re-estilizarlo ‚Üí flashes / saltos de layout.</p>
                    <p><strong>Por eso CSS es render-blocking por defecto.</strong></p>
                </div>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üéôÔ∏è "CSS es render-blocking, JS puede ser parser-blocking"</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <p>Este es un hecho clave para recordar: CSS en el head bloquea el renderizado porque el navegador no pinta contenido sin estilo. JavaScript puede ser parser-blocking si es s√≠ncrono en el head.</p>
                    </div>
                </div>

                <h3>Paso 4 ‚Äî JavaScript (Especialmente Sync en Head)</h3>

                <div class="problem-block" data-title="‚ùå JS S√≠ncrono Bloquea">
                    <p>Los scripts s√≠ncronos pausan el parseo del HTML. El navegador debe:</p>
                    <ol>
                        <li>Descargar el script</li>
                        <li>Parsearlo</li>
                        <li>Ejecutarlo</li>
                        <li>Continuar el parseo del HTML</li>
                    </ol>
                </div>

                <h4>üîç Atributos de Carga de Scripts (Conocimiento Cr√≠tico)</h4>

                <div class="solution-block" data-title="üíª Sin Atributos (DEFAULT ‚Äî BLOQUEANTE)">
<pre><code>&lt;!-- Bloquea el parseo de HTML hasta descargar y ejecutar --&gt;
&lt;script src="/bundle.js"&gt;&lt;/script&gt;</code></pre>
                </div>

                <div class="solution-block" data-title="üíª defer (RECOMENDADO para la mayor√≠a)">
<pre><code>&lt;!-- Descarga en paralelo, se ejecuta despu√©s del parseo del HTML --&gt;
&lt;script defer src="/bundle.js"&gt;&lt;/script&gt;</code></pre>
                </div>

                <div class="solution-block" data-title="üíª async (Para scripts independientes)">
<pre><code>&lt;!-- Descarga en paralelo, se ejecuta inmediatamente cuando est√° listo --&gt;
&lt;!-- Bueno para: analytics, ads, features no cr√≠ticas --&gt;
&lt;script async src="/analytics.js"&gt;&lt;/script&gt;</code></pre>
                </div>

                <div class="solution-block" data-title="üíª type='module' (MODERNO)">
<pre><code>&lt;!-- Por defecto se comporta como defer, soporta import() --&gt;
&lt;script type="module" src="/app.js"&gt;&lt;/script&gt;</code></pre>
                </div>

                <h3>Paso 5 ‚Äî Render Tree (DOM + CSSOM)</h3>

                <div class="concept-block">
                    <p>El navegador combina DOM + CSSOM para crear el Render Tree (solo elementos visibles).</p>
                </div>

                <h3>Paso 6 ‚Äî Style ‚Üí Layout ‚Üí Paint</h3>

                <div class="analogy-block" data-title="üé® Los Tres √öltimos Pasos">
                    <ol>
                        <li><strong>Style:</strong> Calcular estilos finales para cada elemento</li>
                        <li><strong>Layout:</strong> Calcular tama√±os y posiciones</li>
                        <li><strong>Paint:</strong> Dibujar p√≠xeles en pantalla</li>
                    </ol>
                </div>

                <h2>3Ô∏è‚É£ ¬øQu√© Bloquea el "First Render / FCP"?</h2>

                <div class="warning-block" data-title="‚ö†Ô∏è Los Tres Bloqueadores Principales">
                    <ol>
                        <li><strong>Descarga + procesamiento de CSS</strong> (render-blocking)</li>
                        <li><strong>Ejecuci√≥n de JS s√≠ncrono</strong> (parser-blocking)</li>
                        <li><strong>Pausas del parseo de HTML</strong> al encontrar scripts</li>
                    </ol>
                </div>

                <div class="solution-block" data-title="üéØ La Regla del Senior">
                    <p><strong>Para pintar algo, el navegador necesita DOM + CSSOM.</strong></p>
                    <p>Todo lo que retrase la construcci√≥n de DOM/CSSOM o pause el parseo retrasa FCP.</p>
                </div>

                <h2>4Ô∏è‚É£ √Åreas Pr√°cticas de Optimizaci√≥n</h2>

                <h3>A) Estrategia de CSS Cr√≠tico</h3>

                <div class="concept-block">
                    <p><strong>Objetivo:</strong> El navegador tiene el CSS m√≠nimo necesario para above-the-fold sin esperar a un archivo CSS gigante.</p>
                </div>

                <div class="solution-block" data-title="üíª Inline CSS Cr√≠tico + Diferir el Resto">
<pre><code>&lt;head&gt;
  &lt;style&gt;
    /* CSS cr√≠tico solamente - m√≠nimo above-the-fold */
    body { font-family: system-ui; margin: 0; }
    .header { height: 56px; display: flex; align-items: center; }
    .hero { /* ... */ }
  &lt;/style&gt;

  &lt;!-- Cargar el resto sin bloquear --&gt;
  &lt;link rel="preload" href="/styles.css" as="style" /&gt;
  &lt;link rel="stylesheet" href="/styles.css" /&gt;
&lt;/head&gt;</code></pre>
                </div>

                <h3>B) Optimizaci√≥n de Red: preconnect / dns-prefetch</h3>

                <div class="concept-block">
                    <p>Reduce la latencia de red estableciendo conexiones temprano.</p>
                </div>

                <div class="solution-block" data-title="üíª Resource Hints">
<pre><code>&lt;!-- Establece conexi√≥n completa (DNS + TCP + TLS) --&gt;
&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /&gt;

&lt;!-- M√°s ligero: solo DNS --&gt;
&lt;link rel="dns-prefetch" href="//cdn.example.com" /&gt;

&lt;!-- Prefetch: cargar recurso para siguiente navegaci√≥n --&gt;
&lt;link rel="prefetch" href="/next-page.html" /&gt;

&lt;!-- Preload: cargar recurso necesario en esta p√°gina --&gt;
&lt;link rel="preload" as="font" href="/font.woff2" crossorigin /&gt;</code></pre>
                </div>

                <h3>C) Estrategia JavaScript: Code Splitting y Diferimiento</h3>

                <div class="problem-block" data-title="‚ùå El Problema Real: Bundle JS Grande">
                    <p>En apps React, el HTML es peque√±o, CSS bloquea un poco, pero el bundle JS es usualmente el culpable.</p>
                </div>

                <div class="solution-block" data-title="‚úÖ Diferir C√≥digo No Cr√≠tico">
<pre><code>// Cargar lazy features no necesarias para el primer render
button.addEventListener("click", async () => {
  const { openModal } = await import("./modal.js");
  openModal();
});</code></pre>
                </div>

                <div class="analogy-block" data-title="üéØ Plan de Ataque para Bundles Grandes">
                    <ul>
                        <li>Code-split por rutas/features</li>
                        <li>Reducir dependencias pesadas</li>
                        <li>Evitar polyfills innecesarios</li>
                        <li>Tree-shaking y eliminar c√≥digo muerto</li>
                        <li>Diferir features no cr√≠ticas</li>
                    </ul>
                </div>

                <h3>D) Fuentes e Im√°genes Tambi√©n Importan</h3>

                <div class="solution-block" data-title="üíª Carga Inteligente de Fuentes">
<pre><code>@font-face {
  font-family: "MyFont";
  src: url("/myfont.woff2") format("woff2");
  font-display: swap; /* Mostrar fallback mientras carga la fuente personalizada */
}</code></pre>
                </div>

                <h2>5Ô∏è‚É£ C√≥mo Debuguear CRP (Checklist Accionable)</h2>

                <div class="solution-block" data-title="üìä Performance Insights / DevTools Checklist">
                    <p><strong>Cuando abras la pesta√±a Performance, busca:</strong></p>
                    <ul>
                        <li>‚ùì <strong>Render-blocking requests:</strong> ¬øCu√°l CSS/JS bloquea?</li>
                        <li>‚ùì <strong>Long Tasks:</strong> ¬øCu√°l JS toma > 50ms en main thread?</li>
                        <li>‚ùì <strong>Network waterfall:</strong> ¬øQu√© est√° en la ruta cr√≠tica?</li>
                        <li>‚ùì <strong>TTFB:</strong> ¬øQu√© tan r√°pido responde el servidor?</li>
                    </ul>
                </div>

                <div class="concept-block">
                    <h4>üéØ La Pregunta que Siempre Haces</h4>
                    <p><strong>"¬øQu√© request est√° en la ruta cr√≠tica y puedo eliminar, retrasar o hacer m√°s peque√±o?"</strong></p>
                </div>

                <h2>6Ô∏è‚É£ Respuesta Senior para Entrevistas</h2>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üéôÔ∏è "Explica el Critical Rendering Path"</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <p><strong>Respuesta senior:</strong></p>
                        <blockquote>
                            <p>"El Critical Rendering Path es la secuencia de pasos que el navegador toma desde recibir HTML hasta pintar p√≠xeles.</p>
                            <p>Incluye: fetching HTML, parsing para construir DOM, fetching y parsing de CSS para construir CSSOM, manejo de JavaScript s√≠ncrono, combinarlos en un Render Tree, y finalmente calcular layout y pintar.</p>
                            <p>CSS en el head es render-blocking porque el navegador no pinta sin estilos (previene flashes). Los scripts s√≠ncronos son parser-blocking porque pausan el parsing del HTML hasta que se descargan y ejecutan.</p>
                            <p>Para optimizar CRP: inline CSS cr√≠tico, defer de JS no cr√≠tico, eliminar render-blocking requests, y usar resource hints como preconnect. El objetivo es entregar el m√≠nimo necesario para First Contentful Paint lo m√°s r√°pido posible."</p>
                        </blockquote>
                    </div>
                </div>

                <h2>7Ô∏è‚É£ Flujo de Optimizaci√≥n</h2>

                <div class="solution-block" data-title="üîÑ Plan Paso a Paso">
                    <ol>
                        <li><strong>Medir:</strong> Abre Performance Insights / DevTools Performance tab</li>
                        <li><strong>Identificar:</strong> ¬øQu√© est√° bloqueando la ruta cr√≠tica?</li>
                        <li><strong>Decidir:</strong> Para cada bloqueador:
                            <ul>
                                <li>¬øPuedo eliminarlo?</li>
                                <li>¬øPuedo hacerlo m√°s peque√±o?</li>
                                <li>¬øPuedo diferirlo (defer/async/lazy)?</li>
                                <li>¬øPuedo cachearlo mejor?</li>
                            </ul>
                        </li>
                        <li><strong>Ejecutar:</strong> Haz UN cambio</li>
                        <li><strong>Medir de nuevo:</strong> Compara FCP</li>
                        <li><strong>Repite:</strong> 3-5 veces para impacto real</li>
                    </ol>
                </div>

                <!-- ACCORDION SECTION -->
                <h2>üìã Temas Avanzados y Recursos</h2>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üí° Internals del Navegador: Entendimiento Profundo</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <h4>Parser-Blocking vs Render-Blocking</h4>
                        <p><strong>Parser-blocking:</strong> Pausa el parseo del HTML (<code>&lt;script&gt;</code> s√≠ncrono)</p>
                        <p><strong>Render-blocking:</strong> Pausa el renderizado hasta que se descargue el recurso (CSS en head)</p>

                        <h4>Resource Priority Hints</h4>
                        <pre><code>&lt;!-- Alta prioridad - esencial para renderizar --&gt;
&lt;link rel="preload" as="font" href="/font.woff2" crossorigin /&gt;

&lt;!-- Prioridad media - necesario pronto pero no inmediatamente --&gt;
&lt;img src="/hero.webp" loading="eager" fetchpriority="high" /&gt;

&lt;!-- Baja prioridad - puede cargar despu√©s de todo --&gt;
&lt;img src="/below-fold.webp" loading="lazy" /&gt;</code></pre>

                        <h4>El Waterfall: Entendiendo el Orden de Recursos</h4>
                        <p>En la pesta√±a Network de DevTools, ves descargas paralelas vs bloqueantes secuenciales. La ruta cr√≠tica es la cadena secuencial m√°s larga.</p>
                    </div>
                </div>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üõ†Ô∏è Ejemplo Real: Arreglando una P√°gina Lenta</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <h4>Antes (CRP Lento)</h4>
                        <pre><code>&lt;head&gt;
  &lt;link rel="stylesheet" href="huge-bootstrap.css"&gt; &lt;!-- 40KB, bloquea --&gt;
  &lt;script src="app.js"&gt;&lt;/script&gt; &lt;!-- 200KB, bloquea parseo --&gt;
  &lt;link rel="stylesheet" href="theme.css"&gt; &lt;!-- 15KB --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;&lt;/div&gt;
&lt;/body&gt;</code></pre>
                        <p>Problemas: CSS bloquea, JS es s√≠ncrono y masivo, m√∫ltiples recursos render-blocking</p>

                        <h4>Despu√©s (CRP Optimizado)</h4>
                        <pre><code>&lt;head&gt;
  &lt;style&gt;
    /* CSS cr√≠tico inline - ~2KB */
    body { font-family: system-ui; margin: 0; }
    .header { display: flex; height: 56px; }
  &lt;/style&gt;

  &lt;link rel="preload" href="app.js" as="script" /&gt;
  &lt;link rel="preload" href="styles.css" as="style" /&gt;

  &lt;link rel="stylesheet" href="styles.css"&gt; &lt;!-- Despu√©s del CSS cr√≠tico --&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;&lt;/div&gt;
  &lt;!-- Scripts al final, con defer --&gt;
  &lt;script defer src="app.js"&gt;&lt;/script&gt;
&lt;/body&gt;</code></pre>
                        <p>Mejoras: Primer render m√°s r√°pido (CSS cr√≠tico inline), JS diferido (no bloquea parseo)</p>
                    </div>
                </div>

                <div class="interview-block">
                    <div class="interview-title">
                        <span>üìö Referencias y Aprendizaje Adicional</span>
                        <span class="toggle-arrow">‚ñ∂</span>
                    </div>
                    <div class="interview-content">
                        <ul>
                            <li><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path" target="_blank">Google: Critical Rendering Path</a></li>
                            <li><a href="https://web.dev/fcp/" target="_blank">web.dev: First Contentful Paint (FCP)</a></li>
                            <li><a href="https://mdn.mozilla.org/en-US/docs/Glossary/critical_rendering_path" target="_blank">MDN: Critical Rendering Path</a></li>
                            <li><a href="https://developer.chrome.com/docs/devtools/performance/" target="_blank">Chrome DevTools: Performance Analysis</a></li>
                            <li><a href="https://web.dev/render-blocking-resources/" target="_blank">web.dev: Render-Blocking Resources</a></li>
                        </ul>
                    </div>
                </div>

                <!-- REFERENCES SECTION -->
                <h2>üìö Referencias y Recursos Adicionales</h2>

                <div class="solution-block" data-title="Documentaci√≥n Oficial">
                    <ul>
                        <li><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path" target="_blank">Google: Critical Rendering Path</a></li>
                        <li><a href="https://web.dev/fcp/" target="_blank">web.dev: First Contentful Paint (FCP)</a></li>
                        <li><a href="https://mdn.mozilla.org/en-US/docs/Glossary/critical_rendering_path" target="_blank">MDN: Critical Rendering Path</a></li>
                    </ul>
                </div>

                <div class="concept-block">
                    <h4>Herramientas y Debugging</h4>
                    <ul>
                        <li><a href="https://developer.chrome.com/docs/devtools/performance/" target="_blank">Chrome DevTools: Performance Analysis</a></li>
                        <li><a href="https://web.dev/render-blocking-resources/" target="_blank">web.dev: Render-Blocking Resources</a></li>
                        <li><a href="https://web.dev/defer-non-critical-css/" target="_blank">web.dev: Deferring Non-Critical CSS</a></li>
                    </ul>
                </div>

                <div class="analogy-block" data-title="Recursos de Aprendizaje">
                    <ul>
                        <li><a href="https://web.dev/performance/" target="_blank">web.dev: Performance Section</a></li>
                        <li><a href="https://developer.mozilla.org/en-US/docs/Web/Performance" target="_blank">MDN: Web Performance</a></li>
                        <li><a href="https://www.smashingmagazine.com/category/performance" target="_blank">Smashing Magazine: Performance</a></li>
                    </ul>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='14-core-web-vitals.html'">‚Üê Anterior</button>
                    <button class="btn btn-primary" onclick="window.location.href='../../../index.html'">Volver al Inicio ‚Üí</button>
                </div>
            </section>
        </main>
    </div>

    <script src="../../../assets/js/app.js"></script>
</body>
</html>
